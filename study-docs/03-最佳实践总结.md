# WildVoice é¡¹ç›®æœ€ä½³å®è·µæ€»ç»“

## ğŸ¯ ç›®çš„
æ€»ç»“åœ¨å¼€å‘ WildVoice è¿‡ç¨‹ä¸­å­¦åˆ°çš„æœ€ä½³å®è·µï¼Œä½œä¸ºæœªæ¥é¡¹ç›®çš„å‚è€ƒã€‚

---

## ä¸€ã€é¡¹ç›®æ¶æ„è®¾è®¡

### 1.1 æ¨¡å—åŒ–ç»„ç»‡

âœ… **DO - æ¨èåšæ³•**:
```
src/
â”œâ”€â”€ app/              # Next.js App Router
â”‚   â”œâ”€â”€ api/         # API Routes
â”‚   â””â”€â”€ (pages)/     # é¡µé¢
â”œâ”€â”€ modules/         # åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ voices/
â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â”œâ”€â”€ outputs/
â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â””â”€â”€ auth/
â”‚       â””â”€â”€ schemas/
â”œâ”€â”€ lib/             # å…±äº«å·¥å…·å‡½æ•°
â”œâ”€â”€ components/      # å…±äº«ç»„ä»¶
â””â”€â”€ db/              # æ•°æ®åº“é…ç½®
```

**ä¼˜åŠ¿**:
- åŠŸèƒ½å†…èšï¼Œæ˜“äºç»´æŠ¤
- å›¢é˜Ÿåä½œæ—¶å‡å°‘å†²çª
- ä»£ç å¤ç”¨æ€§é«˜

âŒ **DON'T - é¿å…åšæ³•**:
```
src/
â”œâ”€â”€ schemas/         # æ‰€æœ‰ schema æ··åœ¨ä¸€èµ·
â”œâ”€â”€ apis/            # æ‰€æœ‰ API æ··åœ¨ä¸€èµ·
â””â”€â”€ utils/           # æ‰€æœ‰å·¥å…·å‡½æ•°æ··åœ¨ä¸€èµ·
```

---

### 1.2 ç»Ÿä¸€çš„å“åº”æ ¼å¼

âœ… **DO**:
```typescript
// åˆ›å»ºç»Ÿä¸€çš„å“åº”æ¥å£
export interface ApiResponse<T = any> {
    success: boolean;
    data: T | null;
    error: string | null;
    message?: string;
}

// æ‰€æœ‰ API ä½¿ç”¨ç›¸åŒæ ¼å¼
return successResponse({ id: 1, name: "Voice" }, "Created successfully", 201);
```

**ä¼˜åŠ¿**:
- å‰ç«¯å¤„ç†é€»è¾‘ç»Ÿä¸€
- æ˜“äºè°ƒè¯•
- ç±»å‹å®‰å…¨

âŒ **DON'T**:
```typescript
// API 1
return { data: {...} };

// API 2
return { success: true, result: {...} };

// API 3
return {...};  // ç›´æ¥è¿”å›æ•°æ®
```

---

## äºŒã€æ•°æ®åº“è®¾è®¡

### 2.1 Schema å®šä¹‰è§„èŒƒ

âœ… **DO**:
```typescript
export const voicesSchema = sqliteTable("voices", {
    // 1. ä¸»é”®åœ¨æœ€å‰
    id: integer("id").primaryKey({ autoIncrement: true }),

    // 2. å¿…å¡«å­—æ®µ
    name: text("name").notNull(),
    userId: text("user_id")
        .notNull()
        .references(() => user.id, { onDelete: "cascade" }),

    // 3. å¯é€‰å­—æ®µ
    category: text("category"),
    description: text("description"),

    // 4. æ—¶é—´æˆ³åœ¨æœ€å
    createdAt: integer("created_at", { mode: "timestamp" })
        .defaultNow()
        .notNull(),
    updatedAt: integer("updated_at", { mode: "timestamp" })
        .$onUpdate(() => new Date())
        .notNull(),
});
```

**ä¼˜åŠ¿**:
- å­—æ®µé¡ºåºæ¸…æ™°
- æ˜“äºé˜…è¯»å’Œç»´æŠ¤

---

### 2.2 å¤–é”®çº¦æŸ

âœ… **DO**:
```typescript
userId: text("user_id")
    .references(() => user.id, {
        onDelete: "cascade",  // æ˜ç¡®åˆ é™¤è¡Œä¸º
        onUpdate: "no action"
    }),
```

**å¸¸è§çš„ onDelete ç­–ç•¥**:
- `cascade` - çº§è”åˆ é™¤ï¼ˆåˆ é™¤ç”¨æˆ·æ—¶åˆ é™¤å…¶æ‰€æœ‰ voicesï¼‰
- `set null` - è®¾ç½®ä¸º nullï¼ˆåˆ é™¤ç”¨æˆ·æ—¶ voice ä¿ç•™ä½† userId ä¸º nullï¼‰
- `restrict` - ç¦æ­¢åˆ é™¤ï¼ˆæœ‰å…³è”è®°å½•æ—¶ä¸å…è®¸åˆ é™¤ç”¨æˆ·ï¼‰
- `no action` - ä¸é‡‡å–è¡ŒåŠ¨

**é€‰æ‹©æ ‡å‡†**:
- å¼ºä¾èµ–å…³ç³» â†’ `cascade`
- å¼±ä¾èµ–å…³ç³» â†’ `set null`
- é‡è¦æ•°æ®ä¿æŠ¤ â†’ `restrict`

---

### 2.3 Zod éªŒè¯æœ€ä½³å®è·µ

âœ… **DO**:
```typescript
export const insertVoiceSchema = createInsertSchema(voicesSchema, {
    // æ·»åŠ è‡ªå®šä¹‰éªŒè¯è§„åˆ™
    name: z.string().min(1, "åç§°ä¸èƒ½ä¸ºç©º").max(100, "åç§°è¿‡é•¿"),
    rating: z.number().min(0, "æœ€å°ä¸º0").max(5, "æœ€å¤§ä¸º5").optional(),

    // æ›´ä¸¥æ ¼çš„ URL éªŒè¯
    sampleAudioUrl: z
        .string()
        .url("æ— æ•ˆçš„ URL")
        .optional()
        .or(z.literal("")),  // å…è®¸ç©ºå­—ç¬¦ä¸²
});

// æ›´æ–°æ—¶çš„ schema åº”è¯¥æ’é™¤ä¸å¯ä¿®æ”¹å­—æ®µ
export const updateVoiceSchema = insertVoiceSchema.partial().omit({
    id: true,
    userId: true,
    createdAt: true,
});
```

**ä¼˜åŠ¿**:
- æ¸…æ™°çš„é”™è¯¯æç¤º
- é˜²æ­¢æ•°æ®æ±¡æŸ“
- æ›´å®‰å…¨

---

## ä¸‰ã€API å¼€å‘è§„èŒƒ

### 3.1 API è·¯ç”±ç»“æ„

âœ… **DO - RESTful è®¾è®¡**:
```
GET    /api/voices         - è·å–åˆ—è¡¨
POST   /api/voices         - åˆ›å»ºæ–°è®°å½•
GET    /api/voices/[id]    - è·å–å•æ¡è®°å½•
PATCH  /api/voices/[id]    - æ›´æ–°è®°å½•
DELETE /api/voices/[id]    - åˆ é™¤è®°å½•

POST   /api/voices/[id]/rate    - å­èµ„æºæ“ä½œ
```

âŒ **DON'T**:
```
GET    /api/getVoices
POST   /api/createVoice
POST   /api/updateVoice
POST   /api/deleteVoice
```

---

### 3.2 API å®ç°æ ‡å‡†æµç¨‹

âœ… **DO**:
```typescript
export const POST = async (request: Request) => {
    try {
        // 1. è®¤è¯æ£€æŸ¥ï¼ˆæœ€å…ˆï¼‰
        const session = await getSession();
        if (!session?.user) {
            return unauthorizedResponse();
        }

        // 2. è§£æè¯·æ±‚æ•°æ®
        const body = await request.json();

        // 3. æ•°æ®éªŒè¯
        const validated = insertVoiceSchema.parse(body);

        // 4. æƒé™æ£€æŸ¥
        if (validated.isPublic && !session.user.isAdmin) {
            return errorResponse("Only admin can create public voices", 403);
        }

        // 5. ä¸šåŠ¡é€»è¾‘
        const db = await getDb();
        const [newVoice] = await db.insert(voicesSchema)
            .values({
                ...validated,
                userId: session.user.id,
            })
            .returning();

        // 6. è¿”å›ç»“æœ
        return successResponse(newVoice, "Created successfully", 201);

    } catch (error) {
        // 7. é”™è¯¯å¤„ç†
        return handleApiError(error);
    }
};
```

**æµç¨‹é¡ºåº**:
1. è®¤è¯ â†’ 2. è§£æ â†’ 3. éªŒè¯ â†’ 4. æƒé™ â†’ 5. ä¸šåŠ¡é€»è¾‘ â†’ 6. è¿”å› â†’ 7. é”™è¯¯å¤„ç†

---

### 3.3 HTTP çŠ¶æ€ç ä½¿ç”¨

âœ… **DO**:
```typescript
// æˆåŠŸ
200 OK           - æŸ¥è¯¢æˆåŠŸ
201 Created      - åˆ›å»ºæˆåŠŸ
204 No Content   - åˆ é™¤æˆåŠŸï¼ˆæ— è¿”å›å†…å®¹ï¼‰

// å®¢æˆ·ç«¯é”™è¯¯
400 Bad Request      - è¯·æ±‚æ•°æ®æ ¼å¼é”™è¯¯
401 Unauthorized     - æœªè®¤è¯
403 Forbidden        - å·²è®¤è¯ä½†æ— æƒé™
404 Not Found        - èµ„æºä¸å­˜åœ¨
422 Unprocessable    - éªŒè¯å¤±è´¥

// æœåŠ¡å™¨é”™è¯¯
500 Internal Server Error  - æœåŠ¡å™¨é”™è¯¯
```

âŒ **DON'T**:
```typescript
// æ‰€æœ‰æˆåŠŸéƒ½è¿”å› 200
return successResponse(data, "Success", 200);  // åˆ›å»ºä¹Ÿç”¨ 200

// æ‰€æœ‰é”™è¯¯éƒ½è¿”å› 500
return errorResponse("Error", 500);  // éªŒè¯å¤±è´¥ä¹Ÿç”¨ 500
```

---

## å››ã€æ–‡ä»¶å¤„ç†

### 4.1 éŸ³é¢‘æ•°æ®å¤„ç†æµç¨‹

âœ… **DO**:
```typescript
// 1. ç”ŸæˆéŸ³é¢‘
const { audio } = await generateSpeech({...});

// 2. è½¬æ¢ä¸º Bufferï¼ˆNext.js éœ€è¦ï¼‰
const audioBuffer = Buffer.from(audio.uint8Array);

// 3. åˆ›å»º File å¯¹è±¡ï¼ˆR2 ä¸Šä¼ éœ€è¦ï¼‰
const audioFile = new File([audioBuffer], `tts-${Date.now()}.mp3`, {
    type: "audio/mpeg",
});

// 4. ä¸Šä¼ åˆ° R2
const uploadResult = await uploadToR2(audioFile, "tts-outputs");

// 5. ä¿å­˜ URL åˆ°æ•°æ®åº“
await db.insert(outputsSchema).values({
    audioUrl: uploadResult.url,
    ...
});
```

**å…³é”®ç‚¹**:
- `Uint8Array` â†’ `Buffer` â†’ `File`
- è®¾ç½®æ­£ç¡®çš„ MIME ç±»å‹
- ç»Ÿä¸€çš„æ–‡ä»¶å‘½åè§„èŒƒ

---

### 4.2 è¿”å›æ–‡ä»¶å“åº”

âœ… **DO**:
```typescript
// æ–¹å¼ 1: ç›´æ¥è¿”å›äºŒè¿›åˆ¶æ•°æ®ï¼ˆé€‚åˆå°æ–‡ä»¶ï¼‰
return new Response(audioBuffer, {
    status: 200,
    headers: {
        "Content-Type": "audio/mpeg",
        "Content-Disposition": `attachment; filename="${filename}"`,
        "Content-Length": audioBuffer.length.toString(),
    },
});

// æ–¹å¼ 2: è¿”å› URLï¼ˆæ¨èï¼‰
return successResponse({
    audioUrl: "https://cdn.example.com/audio.mp3"
});
```

**é€‰æ‹©æ ‡å‡†**:
- å°æ–‡ä»¶ï¼ˆ<1MBï¼‰â†’ ç›´æ¥è¿”å›
- å¤§æ–‡ä»¶ï¼ˆ>1MBï¼‰â†’ è¿”å› URL
- éœ€è¦ CDN ç¼“å­˜ â†’ è¿”å› URL

---

## äº”ã€ç¯å¢ƒç®¡ç†

### 5.1 ç¯å¢ƒå˜é‡ç»„ç»‡

âœ… **DO**:
```bash
# .dev.vars (æœ¬åœ°å¼€å‘)
FAL_KEY=fal-xxx-local
CLOUDFLARE_R2_URL=https://pub-xxx.r2.dev
DATABASE_URL=...

# wrangler.jsonc (é…ç½®ç»‘å®š)
{
  "r2_buckets": [...],
  "d1_databases": [...],
  "ai": {...}
}

# ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ secrets
pnpm cf:secret FAL_KEY
```

**åˆ†ç±»**:
- æ•æ„Ÿä¿¡æ¯ â†’ Secrets (FAL_KEY)
- å…¬å…±é…ç½® â†’ ç¯å¢ƒå˜é‡ (CLOUDFLARE_R2_URL)
- èµ„æºç»‘å®š â†’ wrangler.jsonc

---

### 5.2 æœ¬åœ°å¼€å‘ä¼˜åŒ–

âœ… **DO - ä½¿ç”¨ Remote Bindings**:
```typescript
// next.config.ts
initOpenNextCloudflareForDev({
    experimental: {
        remoteBindings: true,
    }
});
```

```jsonc
// wrangler.jsonc
{
  "r2_buckets": [{
    "bucket_name": "wild-voice-files",
    "binding": "FILES",
    "experimental_remote": true  // è¿æ¥çœŸå® R2
  }]
}
```

**ä¼˜åŠ¿**:
- URL ç»Ÿä¸€ï¼ˆä¸éœ€è¦æœ¬åœ°/ç”Ÿäº§åˆ‡æ¢ï¼‰
- æ•°æ®ä¸€è‡´æ€§
- æ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ

âŒ **DON'T**:
```typescript
// å¤æ‚çš„ç¯å¢ƒåˆ¤æ–­é€»è¾‘
const isDev = process.env.NODE_ENV === "development";
const url = isDev ? "http://localhost/..." : "https://prod/...";
```

---

## å…­ã€AI SDK ä½¿ç”¨

### 6.1 Provider é…ç½®

âœ… **DO**:
```typescript
// åœ¨å‡½æ•°å†…åŠ¨æ€åˆ›å»º providerï¼ˆè·å–ç¯å¢ƒå˜é‡ï¼‰
export const POST = async (request: Request) => {
    const { env } = await getCloudflareContext();

    const fal = createFal({
        apiKey: env.FAL_KEY  // ä½¿ç”¨ Cloudflare env
    });

    const { audio } = await generateSpeech({
        model: fal.speech('fal-ai/minimax/speech-02-hd'),
        ...
    });
};
```

âŒ **DON'T**:
```typescript
// åœ¨æ¨¡å—é¡¶å±‚åˆ›å»ºï¼ˆæ— æ³•è®¿é—® Cloudflare envï¼‰
import { fal } from '@ai-sdk/fal';  // ä½¿ç”¨ process.env

export const POST = async (request: Request) => {
    // fal æ— æ³•è®¿é—® env.FAL_KEY
};
```

---

### 6.2 è‡ªå®šä¹‰å‚æ•°ä¼ é€’

âœ… **DO**:
```typescript
const { audio } = await generateSpeech({
    model: fal.speech('fal-ai/minimax/speech-02-hd'),
    text: text,
    providerOptions: {
        fal: {  // ä½¿ç”¨ providerOptions ä¼ é€’ç‰¹å®šå‚æ•°
            voice_setting: {
                voice_id: voiceId,
                speed: 1.2,
                pitch: 0,
                emotion: "happy"
            }
        }
    }
});
```

**ä¼˜åŠ¿**:
- ä¿æŒ AI SDK çš„ç»Ÿä¸€æ¥å£
- å¯ä»¥è®¿é—®æä¾›å•†ç‰¹å®šåŠŸèƒ½
- æ˜“äºè¿ç§»åˆ°å…¶ä»–æä¾›å•†

---

## ä¸ƒã€é”™è¯¯å¤„ç†

### 7.1 åˆ†å±‚é”™è¯¯å¤„ç†

âœ… **DO**:
```typescript
// 1. API å±‚ - æ•è·æ‰€æœ‰é”™è¯¯
export const POST = async (request: Request) => {
    try {
        // ä¸šåŠ¡é€»è¾‘
    } catch (error) {
        return handleApiError(error);  // ç»Ÿä¸€å¤„ç†
    }
};

// 2. é”™è¯¯å¤„ç†å™¨ - åˆ†ç±»å¤„ç†
export default function handleApiError(error: unknown) {
    if (error instanceof z.ZodError) {
        // Zod éªŒè¯é”™è¯¯
        return errorResponse(error.issues[0].message, 400);
    }

    if (error instanceof SyntaxError) {
        // JSON è§£æé”™è¯¯
        return errorResponse("Invalid JSON format", 400);
    }

    // æœªçŸ¥é”™è¯¯
    console.error("Unexpected error:", error);
    return errorResponse("Internal server error", 500);
}
```

---

### 7.2 ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯

âœ… **DO**:
```typescript
// Zod schema ä¸­æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
name: z.string().min(1, "å£°éŸ³åç§°ä¸èƒ½ä¸ºç©º").max(100, "åç§°ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦"),
rating: z.number().min(0, "è¯„åˆ†æœ€ä½ä¸º0").max(5, "è¯„åˆ†æœ€é«˜ä¸º5"),
```

âŒ **DON'T**:
```typescript
// ä½¿ç”¨é»˜è®¤é”™è¯¯ä¿¡æ¯
name: z.string().min(1).max(100),  // é”™è¯¯: "String must contain at least 1 character(s)"
```

---

## å…«ã€æµ‹è¯•ä¸è°ƒè¯•

### 8.1 ä½¿ç”¨ .http æ–‡ä»¶æµ‹è¯•

âœ… **DO**:
```http
@baseUrl = http://localhost:3000
@sessionToken = {{your_token}}

### æµ‹è¯•åˆ›å»º
POST {{baseUrl}}/api/voices
Cookie: better-auth.session_token={{sessionToken}}
Content-Type: application/json

{
  "name": "Test Voice",
  "category": "Test"
}

### æµ‹è¯•æŸ¥è¯¢
GET {{baseUrl}}/api/voices
Cookie: better-auth.session_token={{sessionToken}}
```

**ä¼˜åŠ¿**:
- ç‰ˆæœ¬æ§åˆ¶ï¼ˆå¯æäº¤åˆ° gitï¼‰
- å›¢é˜Ÿå…±äº«
- å¿«é€Ÿæµ‹è¯•

---

### 8.2 æ—¥å¿—è®°å½•

âœ… **DO**:
```typescript
// å…³é”®æ­¥éª¤æ·»åŠ æ—¥å¿—
console.log("Calling FAL TTS with:", { text: text.substring(0, 50), voiceId });

try {
    const { audio } = await generateSpeech({...});
    console.log("Audio generated successfully, size:", audio.uint8Array.length);
} catch (error) {
    console.error("TTS Error:", error);
    throw error;
}
```

**è®°å½•å†…å®¹**:
- å…³é”®å‚æ•°ï¼ˆè„±æ•åï¼‰
- æˆåŠŸ/å¤±è´¥çŠ¶æ€
- æ€§èƒ½æŒ‡æ ‡ï¼ˆå¯é€‰ï¼‰

---

## ä¹ã€ä»£ç é£æ ¼

### 9.1 å‘½åè§„èŒƒ

âœ… **DO**:
```typescript
// æ–‡ä»¶å: kebab-case
voice.schema.ts
api-response.ts

// å˜é‡/å‡½æ•°: camelCase
const voiceId = 1;
async function getVoices() {}

// ç±»å‹/æ¥å£: PascalCase
interface ApiResponse {}
type Voice = {...}

// å¸¸é‡: UPPER_SNAKE_CASE
const MAX_UPLOAD_SIZE = 10 * 1024 * 1024;
```

---

### 9.2 æ³¨é‡Šè§„èŒƒ

âœ… **DO**:
```typescript
// 1. å¤æ‚é€»è¾‘æ·»åŠ æ³¨é‡Š
// æ ¹æ®ç¯å¢ƒè¿”å›ä¸åŒçš„ URL
// æœ¬åœ°å¼€å‘ï¼šä½¿ç”¨ä»£ç† API
// ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ R2 å…¬å…± URL
const isDev = process.env.NODE_ENV === "development";

// 2. é‡è¦å‚æ•°è¯´æ˜
/**
 * ä¸Šä¼ æ–‡ä»¶åˆ° R2
 * @param file - è¦ä¸Šä¼ çš„æ–‡ä»¶
 * @param folder - R2 ä¸­çš„æ–‡ä»¶å¤¹è·¯å¾„
 * @returns ä¸Šä¼ ç»“æœï¼ŒåŒ…å« URL å’Œ key
 */
export async function uploadToR2(file: File, folder: string) {}

// 3. TODO æ ‡è®°
// TODO: è®¡ç®—å®é™…éŸ³é¢‘æ—¶é•¿
duration: 0,
```

âŒ **DON'T**:
```typescript
// æ— æ„ä¹‰çš„æ³¨é‡Š
const name = "voice";  // å®šä¹‰ name å˜é‡

// è¿‡æ—¶çš„æ³¨é‡Š
// ä½¿ç”¨ FAL APIï¼ˆå®é™…å·²æ”¹ç”¨ AI SDKï¼‰
const { audio } = await generateSpeech({...});
```

---

## åã€æ€§èƒ½ä¼˜åŒ–

### 10.1 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

âœ… **DO**:
```typescript
// 1. åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
const voices = await db.select({
    id: voicesSchema.id,
    name: voicesSchema.name,
    rating: voicesSchema.rating
}).from(voicesSchema);

// 2. ä½¿ç”¨ limit é™åˆ¶ç»“æœ
.limit(10)

// 3. æ·»åŠ ç´¢å¼•ï¼ˆåœ¨ schema ä¸­ï¼‰
export const voicesSchema = sqliteTable("voices", {
    ...
}, (table) => ({
    userIdIdx: index("user_id_idx").on(table.userId),
}));
```

---

### 10.2 ç¼“å­˜ç­–ç•¥

âœ… **DO**:
```typescript
// R2 è®¾ç½®é•¿æœŸç¼“å­˜
httpMetadata: {
    contentType: file.type,
    cacheControl: "public, max-age=31536000",  // 1å¹´
}

// API å“åº”è®¾ç½®ç¼“å­˜
return new Response(JSON.stringify(data), {
    status: 200,
    headers: {
        "Cache-Control": "public, max-age=300",  // 5åˆ†é’Ÿ
    }
});
```

---

## åä¸€ã€å®‰å…¨æ€§

### 11.1 æƒé™æ£€æŸ¥

âœ… **DO**:
```typescript
// å¤šå±‚æƒé™æ£€æŸ¥
const [voice] = await db.select().from(voicesSchema).where(...);

// 1. å­˜åœ¨æ€§æ£€æŸ¥
if (!voice) {
    return notFoundResponse("Voice not found");
}

// 2. æ‰€æœ‰æƒæ£€æŸ¥
if (!voice.isPublic && voice.userId !== session.user.id) {
    return errorResponse("You don't have access to this voice", 403);
}

// 3. æ“ä½œæƒé™æ£€æŸ¥
if (operation === "delete" && !session.user.isAdmin) {
    return errorResponse("Only admin can delete public voices", 403);
}
```

---

### 11.2 æ•°æ®æ¸…æ´—

âœ… **DO**:
```typescript
// 1. ä½¿ç”¨ Zod éªŒè¯å’Œè½¬æ¢
const schema = z.object({
    name: z.string().trim().min(1).max(100),  // è‡ªåŠ¨å»é™¤ç©ºæ ¼
    rating: z.coerce.number().min(0).max(5),  // å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—
});

// 2. è¿‡æ»¤ä¸è¯¥ç”±ç”¨æˆ·è®¾ç½®çš„å­—æ®µ
const { id, createdAt, updatedAt, ...userInput } = validated;

// 3. ä½¿ç”¨ .omit() æ’é™¤æ•æ„Ÿå­—æ®µ
export const updateVoiceSchema = insertVoiceSchema.partial().omit({
    id: true,
    userId: true,
    createdAt: true,
});
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

åœ¨å®Œæˆä¸€ä¸ªåŠŸèƒ½æ—¶ï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

### æ•°æ®åº“
- [ ] Schema å­—æ®µç±»å‹æ­£ç¡®
- [ ] å¤–é”®å…³è”è®¾ç½®äº† onDelete è¡Œä¸º
- [ ] æ—¶é—´æˆ³å­—æ®µä½¿ç”¨ defaultNow() å’Œ $onUpdate()
- [ ] åˆ›å»ºäº† Zod éªŒè¯ schema
- [ ] è¿è¡Œå¹¶æµ‹è¯•äº† migration

### API
- [ ] å®ç°äº†è®¤è¯æ£€æŸ¥
- [ ] ä½¿ç”¨äº†æ•°æ®éªŒè¯
- [ ] æƒé™æ£€æŸ¥å®Œæ•´
- [ ] ä½¿ç”¨ç»Ÿä¸€å“åº”æ ¼å¼
- [ ] è¿”å›æ­£ç¡®çš„çŠ¶æ€ç 
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### ä»£ç è´¨é‡
- [ ] å‘½åè§„èŒƒä¸€è‡´
- [ ] æ·»åŠ äº†å¿…è¦æ³¨é‡Š
- [ ] æ²¡æœ‰ç¡¬ç¼–ç çš„å€¼
- [ ] ç±»å‹å®‰å…¨ï¼ˆæ—  anyï¼‰
- [ ] ä»£ç æ ¼å¼åŒ–

### æµ‹è¯•
- [ ] åˆ›å»ºäº† .http æµ‹è¯•ç”¨ä¾‹
- [ ] æµ‹è¯•äº†æˆåŠŸåœºæ™¯
- [ ] æµ‹è¯•äº†å¤±è´¥åœºæ™¯
- [ ] éªŒè¯äº†æƒé™æ§åˆ¶

---

_ç”Ÿæˆæ—¶é—´: 2025-10-05_
