# WildVoice é¡¹ç›®è‡ªæµ‹é¢˜åº“

## ğŸ“ è¯´æ˜
æœ¬æ–‡æ¡£åŒ…å«é€‰æ‹©é¢˜ã€å¡«ç©ºé¢˜å’Œç¼–ç¨‹é¢˜ï¼Œå¸®åŠ©ä½ å·©å›ºä»Šå¤©å­¦åˆ°çš„çŸ¥è¯†ã€‚

---

## ä¸€ã€é€‰æ‹©é¢˜ (å•é€‰)

### 1. Drizzle ORM åŸºç¡€

**Q1.1**: åœ¨ Drizzle ORM ä¸­ï¼Œå¦‚ä½•å®šä¹‰ä¸€ä¸ªè‡ªå¢çš„ä¸»é”®ï¼Ÿ
- A. `id: integer("id").primaryKey()`
- B. `id: integer("id").primaryKey({ autoIncrement: true })`
- C. `id: integer("id").autoIncrement().primaryKey()`
- D. `id: integer("id").primary({ increment: true })`

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: åœ¨ Drizzle ORM ä¸­ï¼Œè‡ªå¢ä¸»é”®éœ€è¦ä½¿ç”¨ `.primaryKey({ autoIncrement: true })` é…ç½®ã€‚
</details>

---

**Q1.2**: ä»¥ä¸‹å“ªä¸ªå­—æ®µå®šä¹‰æ˜¯æ­£ç¡®çš„æ—¶é—´æˆ³å­—æ®µï¼Ÿ
- A. `createdAt: text("created_at").defaultNow()`
- B. `createdAt: integer("created_at").timestamp().defaultNow()`
- C. `createdAt: integer("created_at", { mode: "timestamp" }).defaultNow()`
- D. `createdAt: timestamp("created_at").defaultNow()`

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: C

è§£é‡Š: Drizzle ORM åœ¨ SQLite ä¸­ä½¿ç”¨ `integer` å­˜å‚¨æ—¶é—´æˆ³ï¼Œéœ€è¦æŒ‡å®š `{ mode: "timestamp" }` å¹¶ä½¿ç”¨ `.defaultNow()` è®¾ç½®é»˜è®¤å€¼ã€‚
</details>

---

**Q1.3**: å¦‚ä½•å®šä¹‰ä¸€ä¸ªå¤–é”®å…³è”ï¼Œå¹¶åœ¨çˆ¶è®°å½•åˆ é™¤æ—¶çº§è”åˆ é™¤å­è®°å½•ï¼Ÿ
- A. `.references(() => user.id)`
- B. `.references(() => user.id, { onDelete: "cascade" })`
- C. `.foreignKey(() => user.id).cascade()`
- D. `.references(() => user.id).onDelete("cascade")`

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: éœ€è¦åœ¨ `.references()` çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­æŒ‡å®š `{ onDelete: "cascade" }`ã€‚
</details>

---

### 2. Next.js API Routes

**Q2.1**: åœ¨ Next.js 15 App Router ä¸­ï¼Œå¦‚ä½•åˆ›å»ºä¸€ä¸ªåŠ¨æ€ API è·¯ç”±æ¥å¤„ç† `/api/users/[id]`ï¼Ÿ
- A. åˆ›å»º `src/app/api/users/[id].ts`
- B. åˆ›å»º `src/app/api/users/[id]/route.ts`
- C. åˆ›å»º `src/app/api/users/route.ts` å¹¶å¤„ç†å‚æ•°
- D. åˆ›å»º `src/app/api/users/:id/route.ts`

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: App Router ä½¿ç”¨æ–‡ä»¶å¤¹ `[id]` è¡¨ç¤ºåŠ¨æ€è·¯ç”±ï¼Œæ–‡ä»¶åå¿…é¡»æ˜¯ `route.ts`ã€‚
</details>

---

**Q2.2**: ä»¥ä¸‹å“ªç§æ–¹å¼å¯ä»¥æ­£ç¡®è¿”å› JSON å“åº”ï¼Ÿ
- A. `return { data: "hello" }`
- B. `return Response.json({ data: "hello" })`
- C. `return new Response(JSON.stringify({ data: "hello" }), { headers: { 'Content-Type': 'application/json' } })`
- D. B å’Œ C éƒ½æ­£ç¡®

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: D

è§£é‡Š: `Response.json()` æ˜¯ç®€å†™ï¼Œç­‰ä»·äºæ‰‹åŠ¨è®¾ç½® Content-Type çš„æ–¹å¼ã€‚
</details>

---

**Q2.3**: åœ¨ API Route ä¸­å¦‚ä½•è·å– POST è¯·æ±‚çš„ bodyï¼Ÿ
- A. `request.body`
- B. `await request.json()`
- C. `request.json()`
- D. `request.data`

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: éœ€è¦ä½¿ç”¨ `await request.json()` å¼‚æ­¥è§£æè¯·æ±‚ä½“ã€‚
</details>

---

### 3. Cloudflare Workers & R2

**Q3.1**: åœ¨ Cloudflare Workers ç¯å¢ƒä¸­ï¼Œå¦‚ä½•è·å–ç¯å¢ƒå˜é‡ï¼Ÿ
- A. `process.env.FAL_KEY`
- B. `import.meta.env.FAL_KEY`
- C. `const { env } = await getCloudflareContext(); env.FAL_KEY`
- D. `Deno.env.get("FAL_KEY")`

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: C

è§£é‡Š: åœ¨ @opennextjs/cloudflare ä¸­ï¼Œéœ€è¦é€šè¿‡ `getCloudflareContext()` è·å–ç¯å¢ƒå¯¹è±¡ã€‚
</details>

---

**Q3.2**: Remote Bindings çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
- A. åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æœ¬åœ°æ•°æ®åº“
- B. åœ¨æœ¬åœ°å¼€å‘æ—¶è¿æ¥çœŸå®çš„ Cloudflare èµ„æº
- C. è¿œç¨‹è°ƒè¯•ä»£ç 
- D. ç»‘å®šè¿œç¨‹ API

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: Remote Bindings å…è®¸æœ¬åœ°å¼€å‘æ—¶ç›´æ¥è¿æ¥çœŸå®çš„ D1ã€R2ã€KV ç­‰ Cloudflare èµ„æºã€‚
</details>

---

**Q3.3**: ä¸Šä¼ æ–‡ä»¶åˆ° R2 æ—¶ï¼ŒhttpMetadata çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
- A. è®¾ç½®æ–‡ä»¶çš„ HTTP è¯·æ±‚å¤´
- B. è®¾ç½®æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå¦‚ Content-Type å’Œ Cache-Control
- C. è®¾ç½®æ–‡ä»¶çš„è®¿é—®æƒé™
- D. è®¾ç½®æ–‡ä»¶çš„åŠ å¯†é€‰é¡¹

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: httpMetadata ç”¨äºè®¾ç½®æ–‡ä»¶çš„ Content-Typeã€Cache-Control ç­‰ HTTP å“åº”å¤´ä¿¡æ¯ã€‚
</details>

---

### 4. AI SDK

**Q4.1**: ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨ AI SDK è€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ FAL APIï¼Ÿ
- A. AI SDK æ€§èƒ½æ›´å¥½
- B. AI SDK æä¾›ç»Ÿä¸€æ¥å£ï¼Œæ˜“äºåˆ‡æ¢æä¾›å•†
- C. FAL API ä¸ç¨³å®š
- D. AI SDK å…è´¹

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: AI SDK çš„ä¸»è¦ä¼˜åŠ¿æ˜¯æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œå¯ä»¥è½»æ¾åœ¨ä¸åŒ AI æä¾›å•†ä¹‹é—´åˆ‡æ¢ã€‚
</details>

---

**Q4.2**: å¦‚ä½•åœ¨ AI SDK ä¸­ä½¿ç”¨ FAL ç‰¹å®šçš„å‚æ•°ï¼ˆå¦‚ speed, pitchï¼‰ï¼Ÿ
- A. ç›´æ¥ä¼ å…¥å‚æ•°
- B. ä½¿ç”¨ `providerOptions.fal`
- C. ä½¿ç”¨ `headers`
- D. ä¸æ”¯æŒ

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: é€šè¿‡ `providerOptions.fal` å¯ä»¥ä¼ é€’ FAL ç‰¹å®šçš„å‚æ•°ã€‚
</details>

---

**Q4.3**: `generateSpeech` è¿”å›çš„ `audio` å¯¹è±¡å¦‚ä½•è½¬æ¢ä¸º Bufferï¼Ÿ
- A. `Buffer.from(audio)`
- B. `Buffer.from(audio.uint8Array)`
- C. `new Buffer(audio)`
- D. `audio.toBuffer()`

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: B

è§£é‡Š: éœ€è¦è®¿é—® `audio.uint8Array` å±æ€§ï¼Œç„¶åä½¿ç”¨ `Buffer.from()` è½¬æ¢ã€‚
</details>

---

## äºŒã€å¡«ç©ºé¢˜

### 1. Drizzle ORM

**Q1**: åœ¨ Drizzle ORM ä¸­ï¼Œ`createInsertSchema` çš„ä½œç”¨æ˜¯__________ï¼Œ`createSelectSchema` çš„ä½œç”¨æ˜¯__________ã€‚

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ:
- createInsertSchema: ä»æ•°æ®åº“ schema è‡ªåŠ¨ç”Ÿæˆç”¨äºæ’å…¥æ•°æ®çš„ Zod éªŒè¯ schema
- createSelectSchema: ä»æ•°æ®åº“ schema è‡ªåŠ¨ç”Ÿæˆç”¨äºæŸ¥è¯¢æ•°æ®çš„ Zod éªŒè¯ schema
</details>

---

**Q2**: è¦è®©å­—æ®µåœ¨æ›´æ–°æ—¶è‡ªåŠ¨æ›´æ–°æ—¶é—´ï¼Œåº”ä½¿ç”¨ `__________` æ–¹æ³•ã€‚

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: `.$onUpdate(() => new Date())`

ç¤ºä¾‹:
```typescript
updatedAt: integer("updated_at", { mode: "timestamp" })
  .$onUpdate(() => new Date())
  .notNull()
```
</details>

---

### 2. API è®¾è®¡

**Q3**: åˆ›å»ºèµ„æºæˆåŠŸåº”è¿”å› HTTP çŠ¶æ€ç  __________ï¼Œèµ„æºæœªæ‰¾åˆ°åº”è¿”å› __________ï¼Œæœªæˆæƒåº”è¿”å› __________ã€‚

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: 201, 404, 401

- 201 Created - èµ„æºåˆ›å»ºæˆåŠŸ
- 404 Not Found - èµ„æºæœªæ‰¾åˆ°
- 401 Unauthorized - æœªæˆæƒ
</details>

---

**Q4**: åœ¨ API ä¸­ï¼Œåº”è¯¥æŠŠ __________ æ£€æŸ¥æ”¾åœ¨æœ€å‰é¢ï¼Œç„¶åè¿›è¡Œ __________ éªŒè¯ï¼Œæœ€åæ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: è®¤è¯(authentication)ï¼Œæ•°æ®(data validation)

æ ‡å‡†æµç¨‹:
1. è®¤è¯æ£€æŸ¥
2. æƒé™æ£€æŸ¥
3. æ•°æ®éªŒè¯
4. ä¸šåŠ¡é€»è¾‘
5. è¿”å›å“åº”
</details>

---

### 3. æ–‡ä»¶å¤„ç†

**Q5**: è¦è¿”å›éŸ³é¢‘æ–‡ä»¶ï¼ŒResponse çš„ Content-Type åº”è®¾ç½®ä¸º __________ï¼Œå¦‚æœè¦è®©æµè§ˆå™¨ä¸‹è½½è€Œä¸æ˜¯æ’­æ”¾ï¼ŒContent-Disposition åº”è®¾ç½®ä¸º __________ã€‚

<details>
<summary>æŸ¥çœ‹ç­”æ¡ˆ</summary>
ç­”æ¡ˆ: audio/mpeg (æˆ– audio/wav, audio/ogg ç­‰), attachment; filename="xxx.mp3"

ç¤ºä¾‹:
```typescript
{
  'Content-Type': 'audio/mpeg',
  'Content-Disposition': 'attachment; filename="audio.mp3"'
}
```

å¦‚æœè¦åœ¨çº¿æ’­æ”¾ï¼Œä½¿ç”¨ `inline` ä»£æ›¿ `attachment`ã€‚
</details>

---

## ä¸‰ã€ç¼–ç¨‹é¢˜

### é¢˜ç›® 1: åˆ›å»º Category Schema

**éœ€æ±‚**: ä¸º WildVoice åˆ›å»ºä¸€ä¸ª `categories` è¡¨ï¼Œç”¨äºå¯¹ voices è¿›è¡Œåˆ†ç±»ã€‚

**è¦æ±‚**:
1. å­—æ®µï¼šid (è‡ªå¢ä¸»é”®), name (åˆ†ç±»å), description (æè¿°, å¯é€‰), createdAt
2. åˆ›å»ºå¯¹åº”çš„ Zod validation schemas
3. å¯¼å‡º TypeScript ç±»å‹

**æç¤º**: å‚è€ƒ voice.schema.ts çš„ç»“æ„

<details>
<summary>æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>

```typescript
// src/modules/categories/schemas/category.schema.ts
import { integer, sqliteTable, text } from "drizzle-orm/sqlite-core";
import { createInsertSchema, createSelectSchema } from "drizzle-zod";
import { z } from "zod";

export const categoriesSchema = sqliteTable("categories", {
    id: integer("id").primaryKey({ autoIncrement: true }),
    name: text("name").notNull(),
    description: text("description"),
    createdAt: integer("created_at", { mode: "timestamp" })
        .defaultNow()
        .notNull(),
});

export const insertCategorySchema = createInsertSchema(categoriesSchema, {
    name: z.string().min(1, "åˆ†ç±»åç§°ä¸èƒ½ä¸ºç©º").max(50, "åç§°è¿‡é•¿"),
    description: z.string().max(200, "æè¿°è¿‡é•¿").optional(),
});

export const selectCategorySchema = createSelectSchema(categoriesSchema);

export type Category = typeof categoriesSchema.$inferSelect;
export type NewCategory = typeof categoriesSchema.$inferInsert;
```
</details>

---

### é¢˜ç›® 2: å®ç°è·å–å•ä¸ª Voice çš„ API

**éœ€æ±‚**: å®ç° `GET /api/voices/[id]` æ¥å£ï¼Œè¿”å›æŒ‡å®š ID çš„ voice ä¿¡æ¯ã€‚

**è¦æ±‚**:
1. éªŒè¯ç”¨æˆ·è®¤è¯
2. æ£€æŸ¥ voice æ˜¯å¦å­˜åœ¨
3. æ£€æŸ¥æƒé™ï¼ˆåªèƒ½è®¿é—®å…¬å…± voice æˆ–è‡ªå·±çš„ voiceï¼‰
4. ä½¿ç”¨ç»Ÿä¸€å“åº”æ ¼å¼

<details>
<summary>æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>

```typescript
// src/app/api/voices/[id]/route.ts
import { getDb, voicesSchema } from "@/db";
import { eq } from "drizzle-orm";
import { getSession } from "@/modules/auth/utils/auth-utils";
import {
    successResponse,
    unauthorizedResponse,
    notFoundResponse,
    errorResponse,
} from "@/lib/api-response";
import handleApiError from "@/lib/api-error";

export async function GET(
    request: Request,
    { params }: { params: { id: string } }
) {
    try {
        // 1. è®¤è¯æ£€æŸ¥
        const session = await getSession();
        if (!session?.user) {
            return unauthorizedResponse();
        }

        // 2. è·å– voice
        const db = await getDb();
        const voiceId = parseInt(params.id);

        if (isNaN(voiceId)) {
            return errorResponse("Invalid voice ID", 400);
        }

        const [voice] = await db
            .select()
            .from(voicesSchema)
            .where(eq(voicesSchema.id, voiceId))
            .limit(1);

        if (!voice) {
            return notFoundResponse("Voice not found");
        }

        // 3. æƒé™æ£€æŸ¥
        if (!voice.isPublic && voice.userId !== session.user.id) {
            return errorResponse("You don't have access to this voice", 403);
        }

        // 4. è¿”å›ç»“æœ
        return successResponse(voice);
    } catch (error) {
        return handleApiError(error);
    }
}
```
</details>

---

### é¢˜ç›® 3: å®ç°ç»Ÿè®¡åŠŸèƒ½

**éœ€æ±‚**: å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œç»Ÿè®¡ç”¨æˆ·ç”Ÿæˆçš„ TTS æ€»æ•°å’Œæ€»æ—¶é•¿ã€‚

**è¦æ±‚**:
1. æŸ¥è¯¢ outputs è¡¨
2. ç­›é€‰å½“å‰ç”¨æˆ·çš„ TTS è®°å½•
3. è¿”å› `{ count: number, totalDuration: number }`

<details>
<summary>æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>

```typescript
import { getDb, outputsSchema } from "@/db";
import { eq, and, sum, count } from "drizzle-orm";

interface UserStats {
    count: number;
    totalDuration: number;
}

async function getUserTTSStats(userId: string): Promise<UserStats> {
    const db = await getDb();

    const result = await db
        .select({
            count: count(),
            totalDuration: sum(outputsSchema.duration),
        })
        .from(outputsSchema)
        .where(
            and(
                eq(outputsSchema.userId, userId),
                eq(outputsSchema.type, "TTS")
            )
        );

    return {
        count: result[0]?.count || 0,
        totalDuration: result[0]?.totalDuration || 0,
    };
}

// ä½¿ç”¨ç¤ºä¾‹
const stats = await getUserTTSStats(session.user.id);
console.log(`ç”Ÿæˆäº† ${stats.count} ä¸ªè¯­éŸ³ï¼Œæ€»æ—¶é•¿ ${stats.totalDuration} ç§’`);
```
</details>

---

## å››ã€é—®ç­”é¢˜

### Q1: ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Zod éªŒè¯è€Œä¸æ˜¯ç›´æ¥ç”¨ TypeScriptï¼Ÿ

<details>
<summary>æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>

**åŸå› **:

1. **è¿è¡Œæ—¶éªŒè¯**: TypeScript åªåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹ï¼Œæ— æ³•åœ¨è¿è¡Œæ—¶éªŒè¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®
2. **æ•°æ®æ¸…æ´—**: Zod å¯ä»¥è½¬æ¢å’Œè§„èŒƒåŒ–æ•°æ®ï¼ˆå¦‚å»é™¤ç©ºæ ¼ã€è½¬æ¢ç±»å‹ç­‰ï¼‰
3. **å‹å¥½é”™è¯¯**: æä¾›æ¸…æ™°çš„éªŒè¯é”™è¯¯ä¿¡æ¯ï¼Œå¯ä»¥ç›´æ¥è¿”å›ç»™ç”¨æˆ·
4. **å®‰å…¨æ€§**: é˜²æ­¢æ¶æ„è¾“å…¥å’Œ SQL æ³¨å…¥

**ç¤ºä¾‹**:
```typescript
// TypeScript æ— æ³•éªŒè¯è¿è¡Œæ—¶æ•°æ®
function createVoice(data: { name: string }) {
    // å¦‚æœ data.name æ˜¯ undefined æˆ–éå­—ç¬¦ä¸²ï¼ŒTypeScript æ— æ³•é˜»æ­¢
}

// Zod å¯ä»¥åœ¨è¿è¡Œæ—¶éªŒè¯
const schema = z.object({ name: z.string().min(1) });
const validated = schema.parse(data); // ä¼šæŠ›å‡ºé”™è¯¯å¦‚æœä¸ç¬¦åˆ
```
</details>

---

### Q2: è§£é‡Š Remote Bindings çš„å·¥ä½œåŸç†å’Œä½¿ç”¨åœºæ™¯

<details>
<summary>æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>

**å·¥ä½œåŸç†**:
- æœ¬åœ°å¼€å‘æ—¶ï¼Œé€šè¿‡ Wrangler ç›´æ¥è¿æ¥åˆ° Cloudflare çš„çœŸå®èµ„æºï¼ˆD1, R2, KV ç­‰ï¼‰
- ä¸ä½¿ç”¨æœ¬åœ°æ¨¡æ‹Ÿï¼Œæ‰€æœ‰æ“ä½œç›´æ¥åœ¨äº‘ç«¯èµ„æºä¸Šæ‰§è¡Œ
- éœ€è¦åœ¨ `wrangler.jsonc` ä¸­æ·»åŠ  `experimental_remote: true`

**ä½¿ç”¨åœºæ™¯**:
1. **æµ‹è¯•çœŸå®ç¯å¢ƒ** - éªŒè¯ä»£ç åœ¨å®é™… Cloudflare ç¯å¢ƒä¸­çš„è¡¨ç°
2. **å›¢é˜Ÿåä½œ** - å¤šäººå…±äº«åŒä¸€æ•°æ®åº“ï¼Œé¿å…æ•°æ®ä¸åŒæ­¥
3. **é¿å…æœ¬åœ°é™åˆ¶** - æœ¬åœ°æ¨¡æ‹Ÿå¯èƒ½ä¸çœŸå®ç¯å¢ƒæœ‰å·®å¼‚

**ä¼˜åŠ¿**:
- âœ… URL ç»Ÿä¸€ï¼ˆä¸éœ€è¦æœ¬åœ°/ç”Ÿäº§ç¯å¢ƒçš„ URL åˆ‡æ¢é€»è¾‘ï¼‰
- âœ… æ•°æ®ä¸€è‡´æ€§
- âœ… æ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ æ“ä½œç›´æ¥å½±å“çœŸå®æ•°æ®
- âš ï¸ éœ€è¦ç½‘ç»œè¿æ¥
- âš ï¸ å»ºè®®ä½¿ç”¨å•ç‹¬çš„å¼€å‘ç¯å¢ƒèµ„æº
</details>

---

### Q3: ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ `.$onUpdate()` è€Œä¸æ˜¯ `.defaultNow()`ï¼Ÿ

<details>
<summary>æŸ¥çœ‹å‚è€ƒç­”æ¡ˆ</summary>

**åŒºåˆ«**:

1. **`.defaultNow()`**
   - åªåœ¨**é¦–æ¬¡æ’å…¥**æ—¶è®¾ç½®å€¼
   - ç”¨äº `createdAt` å­—æ®µ

2. **`.$onUpdate()`**
   - åœ¨**æ¯æ¬¡æ›´æ–°**æ—¶è®¾ç½®æ–°å€¼
   - ç”¨äº `updatedAt` å­—æ®µ

**ç¤ºä¾‹**:
```typescript
export const voicesSchema = sqliteTable("voices", {
    id: integer("id").primaryKey({ autoIncrement: true }),

    // åˆ›å»ºæ—¶è®¾ç½®ï¼Œæ°¸ä¸æ”¹å˜
    createdAt: integer("created_at", { mode: "timestamp" })
        .defaultNow()
        .notNull(),

    // åˆ›å»ºæ—¶è®¾ç½®ï¼Œæ¯æ¬¡æ›´æ–°æ—¶ä¹Ÿæ›´æ–°
    updatedAt: integer("updated_at", { mode: "timestamp" })
        .defaultNow()  // é¦–æ¬¡æ’å…¥çš„é»˜è®¤å€¼
        .$onUpdate(() => new Date())  // æ¯æ¬¡æ›´æ–°æ—¶çš„å€¼
        .notNull(),
});
```

**è¡Œä¸º**:
```typescript
// INSERT
const voice = await db.insert(voicesSchema).values({ name: "Test" });
// createdAt: 2025-10-05 10:00:00
// updatedAt: 2025-10-05 10:00:00

// UPDATE (5åˆ†é’Ÿå)
await db.update(voicesSchema).set({ name: "Updated" }).where(...);
// createdAt: 2025-10-05 10:00:00  (ä¸å˜)
// updatedAt: 2025-10-05 10:05:00  (æ›´æ–°)
```
</details>

---

## äº”ã€å®æˆ˜æŒ‘æˆ˜é¢˜ ğŸš€

### æŒ‘æˆ˜ 1: å®ç° Voice è¯„åˆ†åŠŸèƒ½

**éœ€æ±‚**: å…è®¸ç”¨æˆ·å¯¹ voice è¿›è¡Œè¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰ï¼Œæ¯ä¸ªç”¨æˆ·åªèƒ½è¯„åˆ†ä¸€æ¬¡ã€‚

**è¦æ±‚**:
1. åˆ›å»º `voice_ratings` è¡¨
2. å®ç° `POST /api/voices/[id]/rate` æ¥å£
3. æ›´æ–° voice çš„å¹³å‡è¯„åˆ†
4. é˜²æ­¢é‡å¤è¯„åˆ†

**æç¤º**: éœ€è¦åˆ›å»ºæ–°çš„ schema å’Œå…³è”æŸ¥è¯¢

---

### æŒ‘æˆ˜ 2: å®ç°åˆ†é¡µæŸ¥è¯¢

**éœ€æ±‚**: ä¸º `GET /api/voices` æ·»åŠ åˆ†é¡µåŠŸèƒ½

**è¦æ±‚**:
1. æ”¯æŒ `page` å’Œ `limit` å‚æ•°
2. è¿”å›æ€»æ•°ã€å½“å‰é¡µã€æ€»é¡µæ•°ç­‰ä¿¡æ¯
3. å“åº”æ ¼å¼ï¼š
```json
{
  "success": true,
  "data": {
    "items": [...],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 100,
      "totalPages": 10
    }
  }
}
```

---

### æŒ‘æˆ˜ 3: å®ç°éŸ³é¢‘æ—¶é•¿è®¡ç®—

**éœ€æ±‚**: åœ¨ä¿å­˜ TTS è¾“å‡ºæ—¶ï¼Œè®¡ç®—å¹¶ä¿å­˜å®é™…çš„éŸ³é¢‘æ—¶é•¿

**æç¤º**:
- å¯èƒ½éœ€è¦ä½¿ç”¨éŸ³é¢‘å¤„ç†åº“ï¼ˆå¦‚ `get-audio-duration`ï¼‰
- æˆ–ä» FAL API å“åº”ä¸­è·å–æ—¶é•¿ä¿¡æ¯

---

## ğŸ“Š è‡ªæµ‹è¯„åˆ†æ ‡å‡†

- **é€‰æ‹©é¢˜**: æ¯é¢˜ 5 åˆ†ï¼Œå…± 60 åˆ†
- **å¡«ç©ºé¢˜**: æ¯é¢˜ 8 åˆ†ï¼Œå…± 40 åˆ†
- **ç¼–ç¨‹é¢˜**: æ¯é¢˜ 20 åˆ†ï¼Œå…± 60 åˆ†
- **é—®ç­”é¢˜**: æ¯é¢˜ 15 åˆ†ï¼Œå…± 45 åˆ†
- **æŒ‘æˆ˜é¢˜**: é€‰åšï¼Œæ¯é¢˜ 30 åˆ†

**æ€»åˆ†**: 205 åˆ†ï¼ˆä¸å«æŒ‘æˆ˜é¢˜ï¼‰

**ç­‰çº§è¯„å®š**:
- ä¼˜ç§€: â‰¥ 180 åˆ†
- è‰¯å¥½: â‰¥ 150 åˆ†
- åˆæ ¼: â‰¥ 120 åˆ†
- éœ€åŠ å¼º: < 120 åˆ†

---

_ç”Ÿæˆæ—¶é—´: 2025-10-05_
